---
config:
  theme: base
  themeVariables:
    primaryColor: '#e8f4f8'
    primaryTextColor: '#1565c0'
    primaryBorderColor: '#1976d2'
    lineColor: '#42a5f5'
    fontFamily: 'Segoe UI, Arial, sans-serif'
    fontSize: 11px
    background: '#fafafa'
  er:
    diagramPadding: 20
    layoutDirection: TB
    minEntityWidth: 120
    minEntityHeight: 60
    entityPadding: 15
    stroke: '#1976d2'
    fill: '#e3f2fd'
    fontSize: 11
title: TSPLIB95 Converter Database Schema
---
erDiagram
    PROBLEMS {
        integer id PK "Primary Key"
        varchar name UK "Unique problem name (e.g., 'gr17')"
        varchar type "TSP|VRP|ATSP|HCP|SOP|TOUR"
        text comment "Problem description/comment"
        integer dimension "Number of nodes/cities"
        integer capacity "Vehicle capacity (VRP only)"
        varchar edge_weight_type "EUC_2D|MAN_2D|CEIL_2D|GEO|ATT|EXPLICIT|etc"
        varchar edge_weight_format "FULL_MATRIX|UPPER_ROW|LOWER_ROW|etc"
        varchar node_coord_type "TWOD_COORDS|THREED_COORDS|NO_COORDS"
        varchar display_data_type "COORD_DISPLAY|TWOD_DISPLAY|NO_DISPLAY"
        varchar file_path "Original file path"
        bigint file_size "File size in bytes"
        timestamp created_at "Record creation time"
        timestamp updated_at "Last update time"
    }
    
    NODES {
        integer id PK "Primary Key"
        integer problem_id FK "Foreign Key to PROBLEMS"
        integer node_id "Original node ID (1-based from TSPLIB)"
        double x "X coordinate"
        double y "Y coordinate"
        double z "Z coordinate (optional)"
        integer demand "Node demand (VRP, default 0)"
        boolean is_depot "Depot flag (VRP, default false)"
        double display_x "Display X coordinate (optional)"
        double display_y "Display Y coordinate (optional)"
    }
    
    EDGES {
        integer id PK "Primary Key"
        integer problem_id FK "Foreign Key to PROBLEMS"
        integer from_node "Source node (0-based normalized)"
        integer to_node "Target node (0-based normalized)"
        double weight "Edge weight/distance"
        boolean is_fixed "Fixed edge in tour (default false)"
    }
    
    TOURS {
        integer id PK "Primary Key"
        integer problem_id FK "Foreign Key to PROBLEMS"
        varchar tour_name "Tour identifier (e.g., 'optimal')"
        text tour_sequence "Node sequence (JSON array)"
        double total_cost "Total tour cost"
        boolean is_optimal "Known optimal solution flag"
        timestamp created_at "Record creation time"
    }
    
    PROBLEM_METADATA {
        integer id PK "Primary Key"
        integer problem_id FK "Foreign Key to PROBLEMS"
        varchar key_name "Metadata key"
        text value "Metadata value (JSON)"
        varchar data_type "string|integer|float|boolean|array|object"
    }
    
    %% Relationships
    PROBLEMS ||--o{ NODES : "has many nodes"
    PROBLEMS ||--o{ EDGES : "has many edges"
    PROBLEMS ||--o{ TOURS : "has tour solutions"
    PROBLEMS ||--o{ PROBLEM_METADATA : "has metadata"
    
    %% Additional constraints and indexes (shown as comments)
    %% UNIQUE(problem_id, node_id) on NODES
    %% UNIQUE(problem_id, from_node, to_node) on EDGES
    %% INDEX on (type, dimension) for PROBLEMS
    %% INDEX on (problem_id, node_id) for NODES
    %% INDEX on (problem_id, from_node, to_node) for EDGES