---
config:
  layout: elk
  theme: forest
  elk:
    mergeEdges: true
    nodePlacementStrategy: BRANDES_KOEPF
    nodeSpacing: 40
  themeVariables:
    primaryColor: '#e8f5e8'
    primaryTextColor: '#1b5e20'
    primaryBorderColor: '#2e7d32'
    lineColor: '#4caf50'
    fontFamily: arial
    fontSize: 11px
    background: '#f9fff9'
  flowchart:
    defaultRenderer: elk
    htmlLabels: true
    curve: basis
    useMaxWidth: true
    diagramPadding: 20
title: TSPLIB95 ETL System Development Plan (Corrected Flow)
---
flowchart TB
    subgraph phase1["Phase 1: Core Infrastructure (2-3 days)"]
        subgraph setup["1.1 Project Setup"]
            setup_dir["âœ… Create src/ directory structure"]
            setup_log["ðŸ”² Set up logging system"]
            setup_except["ðŸ”² Create exception classes"]
            setup_valid["ðŸ”² Implement validation utilities"]
        end
        
        subgraph parser["1.2 TSPLIB95 Parser Integration"]
            parse_wrap["ðŸ”² Wrap tsplib95 library"]
            parse_std["ðŸ”² StandardProblem parsing"]
            parse_valid["ðŸ”² Data validation"]
            parse_meta["ðŸ”² Metadata extraction"]
        end
        
        subgraph database["1.3 Database Foundation"]
            db_schema["ðŸ”² Design schema based on parsed data"]
            db_conn["ðŸ”² Create connection management"]
            db_crud["ðŸ”² Implement CRUD operations"]
            db_migrate["ðŸ”² Add migration support"]
        end
    end
    
    subgraph phase2["Phase 2: Data Processing (3-4 days)"]
        subgraph scanner["2.1 File Scanner"]
            scan_traverse["ðŸ”² Recursive directory traversal"]
            scan_detect["ðŸ”² File type detection"]
            scan_batch["ðŸ”² Batch processing"]
            scan_error["ðŸ”² Error handling"]
        end
        
        subgraph transform["2.2 Data Transformer"]
            trans_norm["ðŸ”² StandardProblem normalization"]
            trans_extract["ðŸ”² Extract nodes/edges/metadata"]
            trans_types["ðŸ”² Handle problem types"]
            trans_json["ðŸ”² JSON flattening"]
        end
        
        subgraph output["2.3 JSON Output"]
            json_writer["ðŸ”² JSON file writer"]
            json_dir["ðŸ”² Directory structure"]
            json_naming["ðŸ”² Naming conventions"]
            json_validate["ðŸ”² JSON validation"]
        end
    end
    
    subgraph phase3["Phase 3: Advanced Features (2-3 days)"]
        subgraph parallel["3.1 Parallel Processing"]
            par_threads["ðŸ”² Thread-safe processing"]
            par_batch["ðŸ”² Configurable batch sizes"]
            par_progress["ðŸ”² Progress tracking"]
            par_memory["ðŸ”² Memory management"]
        end
        
        subgraph cli["3.2 CLI Interface"]
            cli_click["ðŸ”² Click-based CLI"]
            cli_config["ðŸ”² Configuration support"]
            cli_progress["ðŸ”² Progress bars"]
            cli_dry["ðŸ”² Dry-run mode"]
        end
        
        subgraph update["3.3 Update Functionality"]
            upd_detect["ðŸ”² Change detection"]
            upd_incr["ðŸ”² Incremental updates"]
            upd_conflict["ðŸ”² Conflict resolution"]
            upd_backup["ðŸ”² Backup/recovery"]
        end
    end
    
    subgraph phase4["Phase 4: Testing & Optimization (1-2 days)"]
        subgraph testing["4.1 Testing Suite"]
            test_unit["ðŸ”² Unit tests"]
            test_integration["ðŸ”² Integration tests"]
            test_perf["ðŸ”² Performance tests"]
            test_edge["ðŸ”² Edge case tests"]
        end
        
        subgraph optimization["4.2 Performance Optimization"]
            opt_profile["ðŸ”² Memory/time profiling"]
            opt_db["ðŸ”² Database optimization"]
            opt_cache["ðŸ”² Caching strategies"]
            opt_monitor["ðŸ”² Monitoring/metrics"]
        end
    end
    
    %% Phase Dependencies
    phase1 --> phase2
    phase2 --> phase3
    phase3 --> phase4
    
    %% Corrected Internal Dependencies within Phase 1
    setup_dir --> setup_log
    setup_log --> setup_except
    setup_except --> setup_valid
    setup_valid --> parse_wrap
    parse_wrap --> parse_std
    parse_std --> parse_valid
    parse_valid --> parse_meta
    parse_meta --> db_schema
    db_schema --> db_conn
    db_conn --> db_crud
    db_crud --> db_migrate
    
    %% Internal Dependencies within Phase 2
    db_migrate --> scan_traverse
    scan_traverse --> scan_detect
    scan_detect --> scan_batch
    scan_batch --> scan_error
    scan_error --> trans_norm
    trans_norm --> trans_extract
    trans_extract --> trans_types
    trans_types --> trans_json
    trans_json --> json_writer
    json_writer --> json_dir
    json_dir --> json_naming
    json_naming --> json_validate
    
    %% Internal Dependencies within Phase 3
    json_validate --> par_threads
    par_threads --> par_batch
    par_batch --> par_progress
    par_progress --> par_memory
    par_memory --> cli_click
    cli_click --> cli_config
    cli_config --> cli_progress
    cli_progress --> cli_dry
    cli_dry --> upd_detect
    upd_detect --> upd_incr
    upd_incr --> upd_conflict
    upd_conflict --> upd_backup
    
    %% Internal Dependencies within Phase 4
    upd_backup --> test_unit
    test_unit --> test_integration
    test_integration --> test_perf
    test_perf --> test_edge
    test_edge --> opt_profile
    opt_profile --> opt_db
    opt_db --> opt_cache
    opt_cache --> opt_monitor
    
    %% Styling
    classDef completed fill:#c8e6c9,stroke:#4caf50,stroke-width:2px
    classDef inProgress fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    classDef pending fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
    classDef phase fill:#f3e5f5,stroke:#9c27b0,stroke-width:3px
    
    class setup_dir completed
    class setup_log,setup_except,setup_valid inProgress
    class parse_wrap,parse_std,parse_valid,parse_meta,db_schema,db_conn,db_crud,db_migrate pending
    class scan_traverse,scan_detect,scan_batch,scan_error,trans_norm,trans_extract,trans_types,trans_json pending
    class json_writer,json_dir,json_naming,json_validate,par_threads,par_batch,par_progress,par_memory pending
    class cli_click,cli_config,cli_progress,cli_dry,upd_detect,upd_incr,upd_conflict,upd_backup pending
    class test_unit,test_integration,test_perf,test_edge,opt_profile,opt_db,opt_cache,opt_monitor pending